========================================
  快速部署到公网（3分钟完成）
========================================

【方案：Cloudflare Tunnel】⭐ 最简单

✅ 完全免费
✅ 无需公网 IP
✅ 自动 HTTPS
✅ 3分钟部署


========================================
  第一步：下载 Cloudflare Tunnel
========================================

Windows 下载地址：
https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe

下载后：
1. 重命名为：cloudflared.exe
2. 放到 amazonq2api 目录（与本文件同目录）


========================================
  第二步：配置 API 密钥
========================================

双击运行：配置API密钥.bat

会自动创建 .env 文件，内容：
OPENAI_KEYS=sk-790214


========================================
  第三步：一键部署
========================================

双击运行：一键部署_Cloudflare.bat

脚本会自动：
1. 启动本地 API 服务
2. 启动 Cloudflare 内网穿透
3. 显示公网地址

示例输出：
  https://abc-def-ghi.trycloudflare.com

这就是你的公网 API 地址！


========================================
  第四步：测试访问
========================================

【浏览器测试】
访问：https://abc-def-ghi.trycloudflare.com

应该能看到 API 控制面板


【客户端配置】
API 地址：https://abc-def-ghi.trycloudflare.com/v1
API 密钥：sk-790214
模型：claude-sonnet-4.5


【Python 测试】
import openai

client = openai.OpenAI(
    base_url="https://abc-def-ghi.trycloudflare.com/v1",
    api_key="sk-790214"
)

response = client.chat.completions.create(
    model="claude-sonnet-4.5",
    messages=[{"role": "user", "content": "你好"}]
)

print(response.choices[0].message.content)


========================================
  完成！
========================================

✅ 你的 API 服务已部署到公网
✅ 全球任何地方都可以访问
✅ 自动 HTTPS 加密
✅ 24/7 在线（只要你的电脑开机）


========================================
  注意事项
========================================

1. ⚠️ 保持终端窗口开启
   关闭终端会断开连接

2. ⚠️ 保护你的 API 密钥
   不要泄露 sk-790214

3. ⚠️ 公网地址会变化
   每次重启 cloudflared 会生成新地址
   如需固定地址，参考"部署说明.txt"配置方法

4. ⚠️ 电脑需要持续运行
   关机或休眠会导致服务中断


========================================
  高级配置（可选）
========================================

【方案一】固定域名（Cloudflare Tunnel）
需要 Cloudflare 账号和域名
参考：https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/tunnel-guide/

【方案二】云服务器部署
租用云服务器（阿里云/腾讯云/AWS）
参考：部署说明.txt 中的"方案三"

【方案三】Docker 部署
docker-compose up -d
参考：docker-compose.yml


========================================
  故障排查
========================================

【问题】cloudflared 无法启动
解决：
1. 检查是否正确下载并重命名
2. 检查文件是否在正确目录
3. 以管理员身份运行

【问题】本地服务无法启动
解决：
1. 检查端口 8000 是否被占用
2. 检查 Python 环境是否正常
3. 查看终端错误信息

【问题】客户端访问 403
解决：
1. 检查 API 密钥是否正确
2. 请求头添加：Authorization: Bearer sk-790214

【问题】无法访问公网地址
解决：
1. 检查 cloudflared 是否正常运行
2. 检查显示的 URL 是否正确复制
3. 等待 10-30 秒后重试


========================================
  获取帮助
========================================

详细文档：部署说明.txt
项目地址：https://codeberg.org/Korieu/amazonq2api

